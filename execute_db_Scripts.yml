---
- name: Create MySQL Table
  hosts: all
  become: yes
  vars:
    mysql_db_name: vishal-test-test
    mysql_user: root
    mysql_password: "@Jammu93@"
  pre_tasks:
    - name: Install pip
      yum:
        name: pip
        state: present
    - name: Install mysql client
      pip:
        name: pymysql
        state: present  
  tasks:
    - name: Sample DB - {{ mysql_db_name }} creation Task
      mysql_db:
        name: "{{ mysql_db_name }}"
        state: present
        login_user: "{{ mysql_user }}"
        login_password: "{{ mysql_password }}"
      register: db_creation_output
      
    - name: Check the db creation status
      debug:
        var: db_creation_output.invocation.state
      
    - name: Insert Sample Data in to created DB - {{ mysql_db_name }}
      mysql_db:
        name: "{{ mysql_db_name }}"
        state: import
        target: mysql_script.sql
        login_user: "{{ mysql_user }}"
        login_password: "{{ mysql_password }}"
      when: db_creation_ouput.state == present

